<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Cadastro Jurídico - CODEGO</title>
<link rel="shortcut icon" href="{{ url_for('static', filename='imagens_empresas/asentjur.png') }}" type="image/png">


<script src="https://cdn.tailwindcss.com"></script>
<script src="https://unpkg.com/lucide@latest"></script>

<link href="https://cdn.jsdelivr.net/npm/tom-select/dist/css/tom-select.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/tom-select/dist/js/tom-select.complete.min.js"></script>

</head>

<body class="min-h-screen bg-[#002b5c] p-4 md:p-8">

<div class="max-w-4xl mx-auto">

<header class="bg-white rounded-2xl p-6 mb-8 shadow-lg flex flex-col md:flex-row justify-between items-center border border-gray-100">
<div class="flex items-center gap-4">
<img src="{{ url_for('static', filename='logo_codego.png') }}" class="h-12 w-auto">
<div>
<h1 class="text-xl font-bold text-[#002b5c]">Gestão Jurídica</h1>
<p class="text-sm text-gray-500 italic">Novo Registro Processual</p>
</div>
</div>

<a href="{{ url_for('dashboard.menu_jur') }}" class="text-blue-600 hover:text-blue-800 font-medium flex items-center gap-2 text-sm">
<i data-lucide="home" class="w-4 h-4"></i> Início
</a>

</header>

<form action="{{ url_for('cadastro.cadastro_jur') }}" method="POST"
class="bg-white rounded-2xl p-10 shadow-2xl border border-gray-100">

<div class="mb-8">

<h2 class="text-lg font-bold text-[#002b5c] mb-6 flex items-center gap-2 border-b pb-4">
<i data-lucide="search"></i> 1. Selecione a Empresa
</h2>

<select name="empresa_id" id="empresa_id" required onchange="toggleForm(this.value)"
class="w-full p-3 border rounded-lg">

<option value="">-- Clique para selecionar uma empresa --</option>

{% for empresa in empresas %}
<option value="{{ empresa.id }}" data-cnpj="{{ empresa.cnpj }}">
{{ empresa.empresa }} (CNPJ: {{ empresa.cnpj }})
</option>
{% endfor %}

</select>

</div>

<div id="formulario-juridico" class="hidden space-y-6">

<h2 class="text-lg font-bold text-[#002b5c] mb-8 flex items-center gap-2 border-b pb-4">
<i data-lucide="gavel"></i> 2. Informações do Processo
</h2>

<div class="grid grid-cols-1 md:grid-cols-2 gap-6">

<div>
<label class="block text-sm font-semibold text-gray-700 mb-2">Processo Judicial</label>
<input type="text" name="processo_judicial" required
class="w-full p-3 border rounded-lg">
</div>

<div>
<label class="block text-sm font-semibold text-gray-700 mb-2">Status</label>
<input type="text" name="status" required
class="w-full p-3 border rounded-lg">
</div>

</div>

<div>
<label class="block text-sm font-semibold text-gray-700 mb-2">Valor da Causa</label>
<input type="text" name="valor_da_causa"
class="w-full p-3 border rounded-lg">
</div>

<div>
<label class="block text-sm font-semibold text-gray-700 mb-2">Assunto Judicial</label>
<textarea name="assunto_judicial" required rows="3"
class="w-full p-3 border rounded-lg"></textarea>
</div>

<div class="mt-10 flex justify-end gap-4 border-t pt-6">

<button type="button" onclick="window.location.reload()"
class="bg-gray-100 text-gray-600 px-6 py-3 rounded-lg font-bold">
Voltar
</button>

<button type="submit"
class="bg-green-600 text-white px-10 py-3 rounded-lg font-bold flex items-center gap-2">
<i data-lucide="save" class="w-5 h-5"></i> Salvar Registro
</button>

</div>

</div>
</form>
</div>

<script>

lucide.createIcons();

function toggleForm(valor){
const form = document.getElementById('formulario-juridico');

if(valor !== ""){
form.classList.remove('hidden');
form.scrollIntoView({behavior:'smooth'});
}else{
form.classList.add('hidden');
}
}

function normalize(text){
return text.toLowerCase()
.normalize("NFD")
.replace(/[\u0300-\u036f]/g,"");
}

new TomSelect("#empresa_id",{

create:false,
maxOptions:1000,
openOnFocus:true,
highlight:true,
placeholder:"Digite o nome da empresa ou CNPJ...",

score:function(search){

const normalizedSearch = normalize(search);

return function(item){

const text = normalize(item.text);
const cnpj = normalize(item.$option.dataset.cnpj || "");

if(text.includes(normalizedSearch)) return 1;
if(cnpj.includes(normalizedSearch)) return 1;

return 0;

};

},

render:{

option:function(data,escape){

const cnpj = data.$option.dataset.cnpj || "";
const nome = data.text.split('(CNPJ')[0];

return `
<div class="flex flex-col py-1">
<span class="font-semibold text-[#002b5c]">${escape(nome)}</span>
<span class="text-xs text-gray-400 font-mono">${escape(cnpj)}</span>
</div>
`;

},

item:function(data,escape){

const nome = data.text.split('(CNPJ')[0];
return `<div>${escape(nome)}</div>`;

}

}

});

</script>

</body>
</html>
